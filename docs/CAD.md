# Использование движка в CAD-подобных программах

GoEngineKenga можно использовать не только для игр, но и как **3D-визуализатор** в приложениях типа CAD/CAM и настройки траекторий роботов (например, аналог RoboCAD).

**Поддерживаемые форматы:** glTF/GLB. Форматы Inventor (.ipt, .iam) конвертируются через Autodesk Forge — см. [CAD_FORMATS.md](CAD_FORMATS.md).

## Варианты интеграции

### 1. Отдельный процесс + WebSocket (рекомендуется)

Движок запускается как отдельная программа с собственным окном. Ваше приложение (Python/PyQt, C#, Qt и т.д.) управляет сценой по WebSocket.

**Плюсы:** не нужен Cgo, один бинарник движка, любая ОС и язык клиента.

**Как подключить:**

1. Установите движок (установщик или `go build`).
2. Запускайте `kenga run --project <path> --scene <scene> --ws-port 127.0.0.1:7777`.
3. В вашей программе откройте WebSocket-клиент к `ws://127.0.0.1:7777/ws` и отправляйте JSON-команды.

Подробное описание команд и формата сообщений — в [README.md](../README.md) (раздел «Использование как 3D‑движок в CAD/CAM/робототехнике»).

### 2. Встраивание рендера (RenderToBuffer)

Если нужно рисовать 3D внутри вашего окна (например, виджет в PyQt):

- Движок предоставляет интерфейс `FrameRenderer` с методом `RenderToImage() *image.RGBA`.
- Через Cgo можно собрать DLL/so и вызывать рендер из нативного кода; буфер передаётся в ваш UI для отрисовки.

Сейчас основной режим — отдельное окно + WebSocket; embed-режим развивается дальше.

## Подключение движка к своему проекту

### Вариант A: движок как отдельная программа (рекомендуется для CAD)

1. Скачайте репозиторий или установите бинарник:
   ```bash
   git clone https://github.com/GermannM3/GoEngineKenga.git
   cd GoEngineKenga
   go build -o kenga ./cmd/kenga
   ```
2. В вашем приложении запускайте `kenga` как процесс (например, `subprocess.Popen` в Python) с нужными флагами `--project`, `--scene`, `--ws-port`.
3. Путь к бинарнику можно задать переменной окружения `KENGA_CLI`.

### Вариант B: движок как Go-модуль

1. В вашем Go-проекте:
   ```bash
   go mod init myapp
   go get github.com/GermannM3/GoEngineKenga
   ```
2. Импортируйте пакеты движка (`engine/ecs`, `engine/render`, `engine/api` и т.д.) и создавайте мир, сцену, API-сервер в своём коде.
3. Сборка: `go build -o myapp ./cmd/myapp`.

Для CAD-программ на Python/Qt чаще всего достаточно варианта A: отдельный процесс + WebSocket.

## Управление камерой в окне

ПКМ (правая кнопка мыши) — вращение вокруг target, СКМ — панорама, колёсико — зум. Работает в `kenga run` с backend ebiten.

## Ключевые команды WebSocket для CAD/роботов

- `load_model` — загрузка модели (glTF) в сцену с заданным `entity_id`.
- `clear_scene` — очистка сцены.
- `set_camera` — позиция, target, FOV камеры.
- `set_transform` — позиция/поворот/масштаб сущности.
- `set_trajectory` / `add_trajectory_point` / `clear_trajectory` — траектории движения.
- `set_joint` — угол сустава робота (по имени кости).
- `start_dispensing` / `stop_dispensing` — симуляция нанесения мастики/клея.

Ответы: JSON с полем `ok: true` и при необходимости `request_id`. События (коллизии, прогресс и т.д.) приходят отдельными сообщениями.

## Документация по установке

- Установщики (Windows exe, Linux .sh/.deb): [docs/INSTALLER.md](INSTALLER.md).
